@import "tailwindcss";
@import "tw-animate-css";

/* iOS Safe Area Support for Capacitor */
:root {
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-inset-left: env(safe-area-inset-left, 0px);
  --safe-area-inset-right: env(safe-area-inset-right, 0px);
}

/* Apply safe areas to body when in native app */
body.capacitor-ios {
  padding-top: var(--safe-area-inset-top);
  padding-bottom: var(--safe-area-inset-bottom);
  padding-left: var(--safe-area-inset-left);
  padding-right: var(--safe-area-inset-right);
}

/* Fixed bottom elements should account for safe area */
.safe-area-bottom {
  padding-bottom: max(var(--safe-area-inset-bottom), 1rem);
}

/* Fixed top elements should account for safe area */
.safe-area-top {
  padding-top: max(var(--safe-area-inset-top), 1rem);
}

@custom-variant dark (&:is(.dark *));

@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);

  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));
  
  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));
  
  --color-popover: hsl(var(--popover));
  --color-popover-foreground: hsl(var(--popover-foreground));
  
  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  
  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));
  
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  
  --color-chart-1: hsl(var(--chart-1));
  --color-chart-2: hsl(var(--chart-2));
  --color-chart-3: hsl(var(--chart-3));
  --color-chart-4: hsl(var(--chart-4));
  --color-chart-5: hsl(var(--chart-5));
  
  --color-sidebar: hsl(var(--sidebar));
  --color-sidebar-foreground: hsl(var(--sidebar-foreground));
  --color-sidebar-primary: hsl(var(--sidebar-primary));
  --color-sidebar-primary-foreground: hsl(var(--sidebar-primary-foreground));
  --color-sidebar-accent: hsl(var(--sidebar-accent));
  --color-sidebar-accent-foreground: hsl(var(--sidebar-accent-foreground));
  --color-sidebar-border: hsl(var(--sidebar-border));
  --color-sidebar-ring: hsl(var(--sidebar-ring));

  --font-sans: 'Inter', sans-serif;
  --font-heading: 'Barlow', sans-serif;
  
  --radius: 0.75rem;

  --shadow-inner: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
  --animate-float: float 3s ease-in-out infinite;
  --animate-shimmer: shimmer 2s linear infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

@keyframes shimmer {
  from { background-position: 0 0; }
  to { background-position: -200% 0; }
}

.glass {
  @apply bg-white/70 backdrop-blur-xl border border-white/20 shadow-[0_8px_32px_0_rgba(31,38,135,0.07)];
}

.card-hover {
  @apply transition-all duration-500 ease-out hover:shadow-2xl hover:-translate-y-1.5 hover:border-primary/30 active:scale-[0.98];
}

.subtle-border {
  @apply border border-slate-200/60 dark:border-slate-800/60;
}

.text-gradient {
  @apply bg-clip-text text-transparent bg-gradient-to-r from-primary to-primary/60;
}

:root {
  /* Slate Blue / Steel Grey Theme */
  --background: 210 40% 98%;
  --foreground: 222 47% 11%;

  --card: 0 0% 100%;
  --card-foreground: 222 47% 11%;

  --popover: 0 0% 100%;
  --popover-foreground: 222 47% 11%;

  /* Primary: Strong Slate Blue */
  --primary: 215 25% 27%; 
  --primary-foreground: 210 40% 98%;

  /* Secondary: Cool Grey */
  --secondary: 210 40% 96.1%;
  --secondary-foreground: 222 47% 11%;

  /* Muted: Subtle Grey - improved contrast for accessibility (WCAG AA) */
  --muted: 210 40% 96.1%;
  --muted-foreground: 215 20% 40%;

  /* Accent: Safety Orange/Yellow/Blue */
  --accent: 210 40% 96.1%;
  --accent-foreground: 222 47% 11%;

  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;

  --border: 214 32% 91%;
  --input: 214 32% 91%;
  --ring: 222 84% 4.9%;

  --radius: 0.5rem;

  --chart-1: 12 76% 61%;
  --chart-2: 173 58% 39%;
  --chart-3: 197 37% 24%;
  --chart-4: 43 74% 66%;
  --chart-5: 27 87% 67%;

  --sidebar: 215 25% 27%;
  --sidebar-foreground: 210 40% 98%;
  --sidebar-primary: 210 40% 98%;
  --sidebar-primary-foreground: 215 25% 27%;
  --sidebar-accent: 215 25% 35%;
  --sidebar-accent-foreground: 210 40% 98%;
  --sidebar-border: 215 25% 35%;
  --sidebar-ring: 217 91% 60%;
}

.dark {
  --background: 222 47% 11%;
  --foreground: 210 40% 98%;

  --card: 222 47% 11%;
  --card-foreground: 210 40% 98%;

  --popover: 222 47% 11%;
  --popover-foreground: 210 40% 98%;

  --primary: 210 40% 98%;
  --primary-foreground: 222 47% 11%;

  --secondary: 217.2 32.6% 17.5%;
  --secondary-foreground: 210 40% 98%;

  /* Muted: improved contrast for dark mode accessibility */
  --muted: 217.2 32.6% 17.5%;
  --muted-foreground: 215 20% 70%;

  --accent: 217.2 32.6% 17.5%;
  --accent-foreground: 210 40% 98%;

  --destructive: 0 62.8% 30.6%;
  --destructive-foreground: 210 40% 98%;

  --border: 217.2 32.6% 17.5%;
  --input: 217.2 32.6% 17.5%;
  --ring: 212.7 26.8% 83.9%;

  --chart-1: 220 70% 50%;
  --chart-2: 160 60% 45%;
  --chart-3: 30 80% 55%;
  --chart-4: 280 65% 60%;
  --chart-5: 340 75% 55%;
  
  --sidebar: 222 47% 11%;
  --sidebar-foreground: 210 40% 98%;
  --sidebar-primary: 215 25% 27%;
  --sidebar-primary-foreground: 210 40% 98%;
  --sidebar-accent: 217.2 32.6% 17.5%;
  --sidebar-accent-foreground: 210 40% 98%;
  --sidebar-border: 217.2 32.6% 17.5%;
  --sidebar-ring: 212.7 26.8% 83.9%;
}

/* Accent Color Overrides - Applied via theme provider */
.accent-pink {
  --primary: 330 80% 60%;
  --ring: 330 80% 60%;
}
.accent-pink.dark {
  --primary: 330 80% 65%;
  --ring: 330 80% 65%;
}

.accent-purple {
  --primary: 270 70% 55%;
  --ring: 270 70% 55%;
}
.accent-purple.dark {
  --primary: 270 70% 60%;
  --ring: 270 70% 60%;
}

.accent-blue {
  --primary: 217 91% 50%;
  --ring: 217 91% 50%;
}
.accent-blue.dark {
  --primary: 217 91% 60%;
  --ring: 217 91% 60%;
}

.accent-green {
  --primary: 142 70% 40%;
  --ring: 142 70% 40%;
}
.accent-green.dark {
  --primary: 142 70% 50%;
  --ring: 142 70% 50%;
}

.accent-orange {
  --primary: 25 95% 50%;
  --ring: 25 95% 50%;
}
.accent-orange.dark {
  --primary: 25 95% 55%;
  --ring: 25 95% 55%;
}

.accent-teal {
  --primary: 173 80% 35%;
  --ring: 173 80% 35%;
}
.accent-teal.dark {
  --primary: 173 80% 45%;
  --ring: 173 80% 45%;
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply font-sans antialiased bg-background text-foreground;
  }
  h1, h2, h3, h4, h5, h6 {
    @apply font-heading font-bold tracking-tight;
  }
}

/* Consistent spacing utilities */
.section-spacing {
  @apply space-y-6;
}

.form-spacing {
  @apply space-y-4;
}

.tight-spacing {
  @apply space-y-2;
}

/* Card header patterns */
.card-header-row {
  @apply flex items-center justify-between gap-4 flex-wrap;
}

.card-title-lg {
  @apply text-xl font-semibold tracking-tight;
}

.card-title-md {
  @apply text-lg font-semibold tracking-tight;
}

.card-title-sm {
  @apply text-base font-medium;
}

/* Consistent list item patterns */
.list-item {
  @apply flex items-center gap-3 p-3 rounded-lg border bg-card hover:bg-muted/50 transition-colors;
}

.list-item-compact {
  @apply flex items-center gap-2 p-2 rounded-md border bg-card hover:bg-muted/50 transition-colors;
}

/* Touch-friendly interactive areas */
.touch-target {
  @apply min-h-[44px] min-w-[44px];
}

/* Skeleton loading patterns */
.skeleton-text {
  @apply h-4 bg-muted rounded animate-pulse;
}

.skeleton-heading {
  @apply h-6 bg-muted rounded animate-pulse;
}

.skeleton-avatar {
  @apply h-10 w-10 bg-muted rounded-full animate-pulse;
}

.skeleton-card {
  @apply h-24 bg-muted rounded-lg animate-pulse;
}

/* Form field error states */
.field-error {
  @apply text-sm text-destructive mt-1;
}

.input-error {
  @apply border-destructive focus-visible:ring-destructive;
}

/* Improved disabled states */
.disabled-text {
  @apply text-muted-foreground/70;
}

@media print {
  body * {
    visibility: hidden;
  }
  
  #root {
    display: block;
  }

  /* Hide navigation, sidebar, and headers */
  nav, aside, header, .flex-col > .sticky, [role="tablist"], button {
    display: none !important;
  }

  /* Make sure the content is visible */
  main, main * {
    visibility: visible;
  }

  /* Specifically target the preview card content */
  .bg-white.text-black.shadow-2xl {
    visibility: visible !important;
    position: absolute !important;
    left: 0 !important;
    top: 0 !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    box-shadow: none !important;
    max-width: none !important;
  }

  .bg-white.text-black.shadow-2xl * {
    visibility: visible !important;
  }

  main {
    margin: 0 !important;
    padding: 0 !important;
    overflow: visible !important;
  }

  /* Reset background colors for print */
  body, main, div {
    background: white !important;
    color: black !important;
  }
  
  /* Ensure images print */
  img {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}

/* Google Places Autocomplete dropdown - ensure it appears above modals/dialogs */
.pac-container {
  z-index: 100000 !important;
  background-color: hsl(var(--popover)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1) !important;
  font-family: inherit !important;
  margin-top: 4px !important;
  pointer-events: auto !important;
}

.pac-container:after {
  display: none !important;
}

.pac-item {
  padding: 8px 12px !important;
  cursor: pointer !important;
  border-top: 1px solid hsl(var(--border)) !important;
  color: hsl(var(--foreground)) !important;
  font-size: 14px !important;
}

.pac-item:first-child {
  border-top: none !important;
}

.pac-item:hover,
.pac-item-selected {
  background-color: hsl(var(--accent)) !important;
}

.pac-item-query {
  color: hsl(var(--foreground)) !important;
  font-weight: 500 !important;
}

.pac-matched {
  font-weight: 600 !important;
}

.pac-icon {
  display: none !important;
}

/* Dark mode support for Google Places */
.dark .pac-container {
  background-color: hsl(var(--popover)) !important;
}

.dark .pac-item {
  color: hsl(var(--foreground)) !important;
}

.dark .pac-item:hover,
.dark .pac-item-selected {
  background-color: hsl(var(--accent)) !important;
}

/* ============================================
   MOBILE OPTIMIZATIONS
   ============================================ */

/* Mobile touch target sizes - Apple recommends 44px minimum */
.mobile-touch-target {
  min-height: 44px;
  min-width: 44px;
}

/* Larger touch targets for phone sizes */
@media (max-width: 767px) {
  /* Buttons get minimum touch target size */
  button:not(.p-0):not(.h-6):not(.h-8),
  [role="button"]:not(.p-0),
  a.inline-flex {
    min-height: 44px;
  }
  
  /* Form inputs get proper sizing */
  input:not([type="checkbox"]):not([type="radio"]),
  select,
  textarea {
    min-height: 48px;
    font-size: 16px !important; /* Prevents iOS zoom on focus */
  }
  
  /* Improve spacing on cards */
  .card-spacing-mobile {
    @apply p-4;
  }
  
  /* Stack grid items on mobile */
  .mobile-stack {
    @apply flex flex-col gap-3;
  }
  
  /* Full width buttons on mobile */
  .mobile-full-width {
    @apply w-full;
  }
}

/* Small phones (iPhone SE, older Androids - up to 374px) */
@media (max-width: 374px) {
  body {
    font-size: 14px;
  }
  
  h1 { font-size: 1.5rem; }
  h2 { font-size: 1.25rem; }
  h3 { font-size: 1.125rem; }
  
  .container {
    padding-left: 12px;
    padding-right: 12px;
  }
  
  /* Tighter padding on very small screens */
  .card {
    padding: 12px;
  }
}

/* Medium phones (iPhone 14, standard Androids - 375px to 413px) */
@media (min-width: 375px) and (max-width: 413px) {
  .container {
    padding-left: 16px;
    padding-right: 16px;
  }
}

/* Large phones (iPhone Pro Max, large Androids - 414px to 767px) */
@media (min-width: 414px) and (max-width: 767px) {
  .container {
    padding-left: 20px;
    padding-right: 20px;
  }
}

/* Tablet optimizations (iPad Mini portrait 768px, iPad Air/Pro 820px+) */
@media (min-width: 768px) and (max-width: 1023px) {
  .container {
    padding-left: 24px;
    padding-right: 24px;
  }
  
  /* Better spacing for tablet card grids */
  .card {
    padding: 20px;
  }
}

/* Mobile card layout - replaces tables on small screens */
.mobile-card-list {
  @apply flex flex-col gap-3;
}

.mobile-card-item {
  @apply bg-card rounded-lg border p-4 space-y-2;
}

.mobile-card-header {
  @apply flex justify-between items-start gap-2;
}

.mobile-card-title {
  @apply font-medium text-base truncate;
}

.mobile-card-subtitle {
  @apply text-sm text-muted-foreground;
}

.mobile-card-row {
  @apply flex justify-between items-center text-sm;
}

.mobile-card-label {
  @apply text-muted-foreground;
}

.mobile-card-value {
  @apply font-medium text-right;
}

.mobile-card-actions {
  @apply flex gap-2 pt-2 border-t mt-3;
}

/* Hide table, show cards on mobile */
@media (max-width: 767px) {
  .hide-on-mobile {
    display: none !important;
  }
  
  .show-on-mobile {
    display: block !important;
  }
  
  /* Dialog wrapper with safe-area and dvh support for iOS keyboard handling */
  .dialog-wrapper {
    height: 100vh;
    height: 100dvh;
    padding: 16px;
    padding: max(16px, env(safe-area-inset-top, 16px)) max(16px, env(safe-area-inset-right, 16px)) max(16px, env(safe-area-inset-bottom, 16px)) max(16px, env(safe-area-inset-left, 16px));
  }
  
  /* Better sheet sizing */
  [data-state="open"][data-side="bottom"] {
    padding-bottom: calc(16px + var(--safe-area-inset-bottom));
  }
}

/* Show table, hide cards on desktop */
@media (min-width: 768px) {
  .show-on-mobile {
    display: none !important;
  }
  
  .hide-on-mobile {
    display: block !important;
  }
}

/* Mobile navigation bottom safe area */
.mobile-nav-safe {
  padding-bottom: calc(16px + var(--safe-area-inset-bottom));
}

/* Scroll container with momentum on iOS */
.mobile-scroll {
  -webkit-overflow-scrolling: touch;
  overflow-y: auto;
  overscroll-behavior-y: contain;
}

/* Prevent pull-to-refresh interference */
.no-pull-refresh {
  overscroll-behavior-y: none;
}

/* Improved list items for mobile */
@media (max-width: 767px) {
  .list-item {
    @apply p-4 gap-4;
  }
  
  .list-item-compact {
    @apply p-3 gap-3;
  }
}

/* Mobile status badges - slightly larger for touch */
@media (max-width: 767px) {
  .badge {
    @apply px-3 py-1.5 text-xs;
  }
}

/* Landscape phone optimizations */
@media (max-height: 500px) and (orientation: landscape) {
  .hide-in-landscape {
    display: none !important;
  }
  
  /* Reduce vertical spacing in landscape */
  .space-y-4 {
    --tw-space-y-reverse: 0;
    margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));
    margin-bottom: calc(0.5rem * var(--tw-space-y-reverse));
  }
}

/* Dark mode date/time picker icon colors */
.dark input[type="date"]::-webkit-calendar-picker-indicator,
.dark input[type="time"]::-webkit-calendar-picker-indicator,
.dark input[type="datetime-local"]::-webkit-calendar-picker-indicator {
  filter: invert(1);
  opacity: 0.7;
}

.dark input[type="date"]::-webkit-calendar-picker-indicator:hover,
.dark input[type="time"]::-webkit-calendar-picker-indicator:hover,
.dark input[type="datetime-local"]::-webkit-calendar-picker-indicator:hover {
  opacity: 1;
}

/* ============================================
   REDUCED MOTION & PERFORMANCE
   ============================================ */

/* Respect user's reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  /* Still allow essential transform states (no animation, just instant change) */
  .card-hover:hover {
    transform: none;
  }
}

/* Performance optimizations for slow connections (detected via JS) */
.slow-connection img:not([loading="eager"]) {
  content-visibility: auto;
}

.slow-connection .skeleton-card,
.slow-connection .skeleton-text,
.slow-connection .skeleton-heading,
.slow-connection .skeleton-avatar {
  animation: none;
  opacity: 0.5;
}

/* GPU acceleration for frequently animated elements */
.gpu-accelerate {
  transform: translateZ(0);
  will-change: transform;
  backface-visibility: hidden;
}

/* Lazy load images outside viewport */
img[loading="lazy"] {
  content-visibility: auto;
  contain-intrinsic-size: 200px 150px;
}

/* Optimize list rendering */
.virtualized-list {
  contain: strict;
  content-visibility: auto;
  contain-intrinsic-size: auto 500px;
}